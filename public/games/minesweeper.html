<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«é›· - HelloGame</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .game-container {
            width: 100%;
            max-width: 500px;
            position: relative;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 20px 0;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 5px;
        }
        
        .game-info {
            display: flex;
            gap: 20px;
        }
        
        .game-info div {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .game-info i {
            font-size: 20px;
        }
        
        .mines-count, .timer {
            font-size: 18px;
            font-weight: bold;
        }
        
        .game-board {
            display: grid;
            gap: 2px;
            margin: 0 auto;
            background-color: #bbbbbb;
            border: 3px solid #7b7b7b;
            border-radius: 5px;
        }
        
        .cell {
            width: 30px;
            height: 30px;
            background-color: #c0c0c0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            font-size: 16px;
            border: 2px solid;
            border-color: #f5f5f5 #7b7b7b #7b7b7b #f5f5f5;
        }
        
        .cell.revealed {
            background-color: #e0e0e0;
            border-color: #7b7b7b;
            border-width: 1px;
        }
        
        .cell.mine {
            background-color: #ff4d4d;
        }
        
        .cell.flagged {
            background-color: #c0c0c0;
        }
        
        .cell.number-1 { color: blue; }
        .cell.number-2 { color: green; }
        .cell.number-3 { color: red; }
        .cell.number-4 { color: darkblue; }
        .cell.number-5 { color: darkred; }
        .cell.number-6 { color: teal; }
        .cell.number-7 { color: black; }
        .cell.number-8 { color: gray; }
        
        .difficulty-selector {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .difficulty-selector button {
            background-color: #4a69bd;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 5px;
            transition: background-color 0.2s;
        }
        
        .difficulty-selector button:hover {
            background-color: #1e3799;
        }
        
        .difficulty-selector button.active {
            background-color: #1e3799;
        }
        
        .game-controls {
            margin-top: 15px;
            text-align: center;
        }
        
        .game-controls button {
            background-color: #4a69bd;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 5px;
            transition: background-color 0.2s;
        }
        
        .game-controls button:hover {
            background-color: #1e3799;
        }
        
        .game-message {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            z-index: 10;
        }
        
        .game-message.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .game-message h2 {
            font-size: 32px;
            margin-bottom: 15px;
        }
        
        .game-message p {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .restart-btn {
            background-color: #4a69bd;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .restart-btn:hover {
            background-color: #1e3799;
        }
        
        .instructions {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            text-align: center;
        }
        
        @media (max-width: 640px) {
            .game-container {
                width: 95%;
                padding: 15px;
            }
            
            .cell {
                width: 25px;
                height: 25px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="game-info">
                <div>
                    <i>ğŸ’£</i>
                    <span class="mines-count">10</span>
                </div>
                <div>
                    <i>â±ï¸</i>
                    <span class="timer">0</span>
                </div>
            </div>
        </div>
        
        <div class="difficulty-selector">
            <button data-difficulty="easy" class="active">åˆçº§</button>
            <button data-difficulty="medium">ä¸­çº§</button>
            <button data-difficulty="hard">é«˜çº§</button>
        </div>
        
        <div class="game-board" id="board"></div>
        
        <div class="game-controls">
            <button id="restart-btn">é‡æ–°å¼€å§‹</button>
        </div>
        
        <div class="instructions">
            å·¦é”®ç‚¹å‡»æ­ç¤ºæ ¼å­ï¼Œå³é”®ç‚¹å‡»æ ‡è®°åœ°é›·
        </div>
        
        <div class="game-message" id="game-message">
            <h2 id="message-title">æ¸¸æˆç»“æŸ!</h2>
            <p id="message-text">å†è¯•ä¸€æ¬¡å§!</p>
            <button class="restart-btn" id="message-restart-btn">é‡æ–°å¼€å§‹</button>
        </div>
    </div>
    
    <script>
        // æ¸¸æˆé…ç½®
        const difficulties = {
            easy: { rows: 9, cols: 9, mines: 10 },
            medium: { rows: 16, cols: 16, mines: 40 },
            hard: { rows: 16, cols: 30, mines: 99 }
        };
        
        // æ¸¸æˆå˜é‡
        let board = [];
        let minesPositions = [];
        let gameOver = false;
        let gameWon = false;
        let flagsCount = 0;
        let revealedCount = 0;
        let startTime = null;
        let timerInterval = null;
        let currentDifficulty = 'easy';
        
        // DOM å…ƒç´ 
        const boardElement = document.getElementById('board');
        const minesCountElement = document.querySelector('.mines-count');
        const timerElement = document.querySelector('.timer');
        const restartBtn = document.getElementById('restart-btn');
        const messageElement = document.getElementById('game-message');
        const messageTitleElement = document.getElementById('message-title');
        const messageTextElement = document.getElementById('message-text');
        const messageRestartBtn = document.getElementById('message-restart-btn');
        const difficultyButtons = document.querySelectorAll('.difficulty-selector button');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // æ¸…é™¤æ—§çš„æ¸¸æˆçŠ¶æ€
            clearInterval(timerInterval);
            board = [];
            minesPositions = [];
            gameOver = false;
            gameWon = false;
            flagsCount = 0;
            revealedCount = 0;
            startTime = null;
            
            // æ›´æ–°åœ°é›·è®¡æ•°æ˜¾ç¤º
            const { mines } = difficulties[currentDifficulty];
            minesCountElement.textContent = mines;
            timerElement.textContent = '0';
            
            // åˆ›å»ºæ¸¸æˆæ¿
            createBoard();
            
            // éšè—æ¸¸æˆç»“æŸæ¶ˆæ¯
            messageElement.classList.remove('active');
        }
        
        // åˆ›å»ºæ¸¸æˆæ¿
        function createBoard() {
            const { rows, cols, mines } = difficulties[currentDifficulty];
            
            // è°ƒæ•´æ¸¸æˆæ¿æ ·å¼
            boardElement.style.gridTemplateRows = `repeat(${rows}, 30px)`;
            boardElement.style.gridTemplateColumns = `repeat(${cols}, 30px)`;
            
            // æ¸…ç©ºæ¸¸æˆæ¿
            boardElement.innerHTML = '';
            
            // åˆ›å»ºæ ¼å­
            for (let row = 0; row < rows; row++) {
                board[row] = [];
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('contextmenu', handleCellRightClick);
                    
                    boardElement.appendChild(cell);
                    
                    // åˆå§‹åŒ–æ ¼å­çŠ¶æ€
                    board[row][col] = {
                        element: cell,
                        isMine: false,
                        isRevealed: false,
                        isFlagged: false,
                        adjacentMines: 0
                    };
                }
            }
        }
        
        // åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»åæ”¾ç½®åœ°é›·
        function placeMines(firstRow, firstCol) {
            const { rows, cols, mines } = difficulties[currentDifficulty];
            let minesPlaced = 0;
            
            // éšæœºæ”¾ç½®åœ°é›·
            while (minesPlaced < mines) {
                const row = Math.floor(Math.random() * rows);
                const col = Math.floor(Math.random() * cols);
                
                // ä¸åœ¨ç¬¬ä¸€æ¬¡ç‚¹å‡»çš„ä½ç½®åŠå…¶å‘¨å›´æ”¾ç½®åœ°é›·
                if (!board[row][col].isMine && 
                    !(Math.abs(row - firstRow) <= 1 && Math.abs(col - firstCol) <= 1)) {
                    board[row][col].isMine = true;
                    minesPositions.push({ row, col });
                    minesPlaced++;
                }
            }
            
            // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    if (!board[row][col].isMine) {
                        board[row][col].adjacentMines = countAdjacentMines(row, col);
                    }
                }
            }
        }
        
        // è®¡ç®—å‘¨å›´çš„åœ°é›·æ•°
        function countAdjacentMines(row, col) {
            let count = 0;
            
            // æ£€æŸ¥å‘¨å›´8ä¸ªæ ¼å­
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    const newRow = row + i;
                    const newCol = col + j;
                    
                    // æ£€æŸ¥è¾¹ç•Œ
                    if (newRow >= 0 && newRow < board.length && 
                        newCol >= 0 && newCol < board[0].length) {
                        if (board[newRow][newCol].isMine) {
                            count++;
                        }
                    }
                }
            }
            
            return count;
        }
        
        // å¤„ç†æ ¼å­ç‚¹å‡»äº‹ä»¶
        function handleCellClick(event) {
            if (gameOver) return;
            
            const cell = event.target;
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            // å¦‚æœæ ¼å­å·²æ ‡è®°æˆ–å·²æ­ç¤ºï¼Œä¸åšä»»ä½•æ“ä½œ
            if (board[row][col].isFlagged || board[row][col].isRevealed) return;
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œå¼€å§‹æ¸¸æˆ
            if (!startTime) {
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000);
                placeMines(row, col);
            }
            
            // æ­ç¤ºæ ¼å­
            revealCell(row, col);
            
            // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
            checkGameStatus();
        }
        
        // å¤„ç†å³é”®ç‚¹å‡»äº‹ä»¶ï¼ˆæ ‡è®°åœ°é›·ï¼‰
        function handleCellRightClick(event) {
            event.preventDefault();
            
            if (gameOver) return;
            
            const cell = event.target;
            const row = parseInt(cell.dataset.row);
            const col = parseInt(cell.dataset.col);
            
            // å¦‚æœæ ¼å­å·²æ­ç¤ºï¼Œä¸åšä»»ä½•æ“ä½œ
            if (board[row][col].isRevealed) return;
            
            // åˆ‡æ¢æ ‡è®°çŠ¶æ€
            if (board[row][col].isFlagged) {
                board[row][col].isFlagged = false;
                cell.innerHTML = '';
                cell.classList.remove('flagged');
                flagsCount--;
            } else {
                board[row][col].isFlagged = true;
                cell.innerHTML = 'ğŸš©';
                cell.classList.add('flagged');
                flagsCount++;
            }
            
            // æ›´æ–°åœ°é›·è®¡æ•°
            const { mines } = difficulties[currentDifficulty];
            minesCountElement.textContent = mines - flagsCount;
            
            // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
            checkGameStatus();
        }
        
        // æ­ç¤ºæ ¼å­
        function revealCell(row, col) {
            // å¦‚æœæ ¼å­è¶…å‡ºè¾¹ç•Œæˆ–å·²æ­ç¤ºæˆ–å·²æ ‡è®°ï¼Œè¿”å›
            if (row < 0 || row >= board.length || 
                col < 0 || col >= board[0].length || 
                board[row][col].isRevealed || 
                board[row][col].isFlagged) {
                return;
            }
            
            // æ ‡è®°ä¸ºå·²æ­ç¤º
            board[row][col].isRevealed = true;
            board[row][col].element.classList.add('revealed');
            revealedCount++;
            
            // å¦‚æœæ˜¯åœ°é›·ï¼Œæ¸¸æˆç»“æŸ
            if (board[row][col].isMine) {
                board[row][col].element.textContent = 'ğŸ’£';
                board[row][col].element.classList.add('mine');
                gameOver = true;
                endGame(false);
                return;
            }
            
            // å¦‚æœå‘¨å›´æœ‰åœ°é›·ï¼Œæ˜¾ç¤ºæ•°å­—
            if (board[row][col].adjacentMines > 0) {
                board[row][col].element.textContent = board[row][col].adjacentMines;
                board[row][col].element.classList.add(`number-${board[row][col].adjacentMines}`);
            } else {
                // å¦‚æœå‘¨å›´æ²¡æœ‰åœ°é›·ï¼Œè‡ªåŠ¨æ­ç¤ºå‘¨å›´çš„æ ¼å­
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        revealCell(row + i, col + j);
                    }
                }
            }
        }
        
        // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
        function checkGameStatus() {
            const { rows, cols, mines } = difficulties[currentDifficulty];
            const totalCells = rows * cols;
            
            // å¦‚æœæ‰€æœ‰éåœ°é›·æ ¼å­éƒ½å·²æ­ç¤ºï¼Œæ¸¸æˆèƒœåˆ©
            if (revealedCount === totalCells - mines) {
                gameWon = true;
                endGame(true);
            }
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame(isWin) {
            gameOver = true;
            clearInterval(timerInterval);
            
            // æ­ç¤ºæ‰€æœ‰åœ°é›·
            if (!isWin) {
                revealAllMines();
            } else {
                // æ ‡è®°æ‰€æœ‰åœ°é›·
                flagAllMines();
            }
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸæ¶ˆæ¯
            if (isWin) {
                messageTitleElement.textContent = 'æ­å–œä½ èµ¢äº†!';
                messageTextElement.textContent = `ç”¨æ—¶: ${timerElement.textContent}ç§’`;
            } else {
                messageTitleElement.textContent = 'æ¸¸æˆç»“æŸ!';
                messageTextElement.textContent = 'å†è¯•ä¸€æ¬¡å§!';
            }
            
            messageElement.classList.add('active');
        }
        
        // æ­ç¤ºæ‰€æœ‰åœ°é›·
        function revealAllMines() {
            minesPositions.forEach(({ row, col }) => {
                if (!board[row][col].isFlagged) {
                    board[row][col].element.textContent = 'ğŸ’£';
                    board[row][col].element.classList.add('revealed');
                    board[row][col].element.classList.add('mine');
                }
            });
        }
        
        // æ ‡è®°æ‰€æœ‰åœ°é›·
        function flagAllMines() {
            minesPositions.forEach(({ row, col }) => {
                if (!board[row][col].isFlagged) {
                    board[row][col].isFlagged = true;
                    board[row][col].element.innerHTML = 'ğŸš©';
                    board[row][col].element.classList.add('flagged');
                }
            });
        }
        
        // æ›´æ–°è®¡æ—¶å™¨
        function updateTimer() {
            if (startTime && !gameOver) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                timerElement.textContent = elapsed;
            }
        }
        
        // åˆ‡æ¢éš¾åº¦
        function switchDifficulty(difficulty) {
            currentDifficulty = difficulty;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            difficultyButtons.forEach(button => {
                if (button.dataset.difficulty === difficulty) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            
            // é‡æ–°åˆå§‹åŒ–æ¸¸æˆ
            initGame();
        }
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        restartBtn.addEventListener('click', initGame);
        messageRestartBtn.addEventListener('click', initGame);
        
        difficultyButtons.forEach(button => {
            button.addEventListener('click', () => {
                switchDifficulty(button.dataset.difficulty);
            });
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html> 